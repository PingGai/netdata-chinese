try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="5cfb2061-f300-46db-b9b2-0664e878069e",e._sentryDebugIdIdentifier="sentry-dbid-5cfb2061-f300-46db-b9b2-0664e878069e")}catch(e){}("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:{}).SENTRY_RELEASE={id:"6f1faf434b0a85eb183c91391b598f364a828f27"};(self.webpackChunkcloud_frontend=self.webpackChunkcloud_frontend||[]).push([[6571],{66571:(e,t,n)=>{n.r(t),n.d(t,{default:()=>He});n(98992),n(54520),n(81454);var l=n(96540),a=n(65258),s=n(79748),o=n(98563),r=n(63950),i=n.n(r),d=n(73613),u=n(37437),c=n(74848);const h=e=>{let{scope:t,setScope:n=i(),isDisabled:l,...s}=e;return(0,c.jsx)(a.Flex,{gap:3,...s,children:Object.entries(u.Wu).map((e=>{let[s,{text:o,tooltip:r}]=e;return(0,c.jsx)(a.RadioButton,{checked:s===t,onChange:()=>n(s),disabled:l,children:(0,c.jsx)(d.A,{content:r,align:"bottom",children:(0,c.jsx)(a.TextSmall,{color:"textDescription",children:o})})},s)}))})};var p=n(80320),g=n(6304);const m=e=>{let{selectedKey:t,selectedValue:n,onAddHostLabel:s=i(),onRemoveHostLabel:o=i(),isDefault:r=!1,showPlaceholder:u=i(),isDisabled:h}=e;const[g,m]=(0,l.useState)(t||""),[x,b]=(0,l.useState)(n||""),C=()=>{g&&x&&(s({[g]:x}),u())};return(0,c.jsxs)(a.Flex,{gap:2,children:[(0,c.jsx)(p.A,{component:"input",onChange:m,onBlur:C,placeholder:"Host key",value:g,disabled:h||!r}),(0,c.jsx)(p.A,{component:"input",onChange:b,onBlur:C,placeholder:"Host value",value:x,disabled:h||!r||!g}),r?(0,c.jsx)(d.A,{content:"Save label pair",align:"bottom",children:(0,c.jsx)(a.Button,{flavour:"borderless",disabled:!g||!x,children:(0,c.jsx)(a.Icon,{name:"check",color:"primary",size:"small"})})}):(0,c.jsx)(d.A,{content:"Remove label pair",align:"bottom",children:(0,c.jsx)(a.Button,{flavour:"borderless",onClick:()=>o(t),children:(0,c.jsx)(a.Icon,{name:"x",color:"primary",size:"small"})})})]})},x=e=>{let{hostLabels:t,onAddHostLabel:n,onRemoveHostLabel:l}=e;return Object.entries(t).map((e=>{let[t,a]=e;return(0,c.jsx)(m,{onAddHostLabel:n,selectedKey:t,selectedValue:a,onRemoveHostLabel:l},t)}))},b=e=>{let{hostLabels:t,onAddHostLabel:n=i(),onRemoveHostLabel:l=i(),isEdit:s,isDisabled:o}=e;const r=!!Object.entries(t||{}).length,[d,,u]=(0,g.A)(!1);return(0,c.jsxs)(a.Flex,{column:!0,gap:1,children:[(0,c.jsx)(a.TextSmall,{color:"textLite",children:"Host labels"}),r&&(0,c.jsx)(x,{hostLabels:t,onAddHostLabel:n,onRemoveHostLabel:l}),(!r||d)&&(0,c.jsx)(m,{onAddHostLabel:n,isDefault:!0,showPlaceholder:u,isDisabled:o},JSON.stringify(t)),s&&!d&&r&&(0,c.jsx)(a.Flex,{justifyContent:"end",children:(0,c.jsx)(a.Button,{flavour:"borderless",onClick:u,children:"Add host label"})})]})};var C=n(46123),f=n(43329),j=n(52365);function v(e){const t=(0,j.A)(e?.in),n=t.getFullYear(),l=t.getMonth(),a=t.getDate(),s=(0,f.w)(e?.in,0);return s.setFullYear(n,l,a+1),s.setHours(0,0,0,0),s}var D=n(6463),S=n(42539),A=n(42790);const R=Object.entries(u.SB).map((e=>{let[t,n]=e;return{label:n,value:t}})),y=v(),E=(0,D.o)((0,S.W)(y,{years:1})),I=e=>{let{duration:t,setDuration:n,setDate:l,endDate:s,isDisabled:o}=e;const r=(0,A.rW)("offset");return(0,c.jsxs)(a.Flex,{gap:2,children:[(0,c.jsx)(p.A,{component:"select",title:"Duration",onChange:n,options:R,placeholder:"Select duration",value:t,isDisabled:o}),"custom"===t.value&&(0,c.jsx)(a.Flex,{alignSelf:"end",children:(0,c.jsx)(C.A,{isSinglePicker:!0,values:{singleDate:s},minDate:y,maxDate:E,utc:r,onChange:l,isPlaying:!1,accessorProps:u.Iv,padding:[4,0],width:"auto",accessorTooltipContent:"Select end date"})})]})},O=e=>{let{startDate:t,startOfToday:n,onStartDateChange:l,endDate:s,minEndDate:o,onEndDateChange:r,inOneYear:i,offset:d,forceRenderEndDate:h}=e;return(0,c.jsxs)(a.Flex,{gap:2,children:[(0,c.jsxs)(a.Flex,{column:!0,gap:2,flex:{grow:1,shrink:1},basis:0,children:[(0,c.jsx)(a.TextSmall,{children:"Start date"}),(0,c.jsx)(C.A,{isSinglePicker:!0,values:{singleDate:new Date(t)},minDate:n(),maxDate:i,utc:d,onChange:l,isPlaying:!1,accessorProps:u.Iv,padding:[4,0],width:"auto",accessorTooltipContent:"Select start date"})]}),(0,c.jsxs)(a.Flex,{column:!0,gap:2,flex:{grow:1,shrink:1},basis:0,children:[(0,c.jsx)(a.TextSmall,{children:"End date"}),(0,c.jsx)(C.A,{isSinglePicker:!0,values:{singleDate:s?new Date(s):s},minDate:o,maxDate:i,utc:d,onChange:r,isPlaying:!1,accessorProps:u.Iv,padding:[4,0],width:"auto",accessorTooltipContent:"Select end date"},h)]})]})},k=(0,l.memo)(O);n(72577);const T=e=>{let{value:t,onChange:n}=e;const s=(0,l.useMemo)((()=>u.q.find((e=>e.value==t))||""),[t]);return(0,c.jsx)(a.Select,{"data-testid":"recurrence-main-selector",value:s,options:u.q,onChange:n,styles:{size:"tiny"},menuPlacement:"auto"})},w=e=>{let{freq:t,interval:n,onFreqChange:s,onIntervalChange:o}=e;const r=(0,l.useMemo)((()=>u.Ws.find((e=>e.value==t))||""),[t]);return(0,c.jsxs)(a.Flex,{gap:2,alignItems:"center",children:[(0,c.jsx)(a.Text,{children:"Repeat every"}),(0,c.jsx)(a.TextInput,{"data-testid":"rrule-prop-interval",width:20,value:n,onChange:o,type:"number",min:1,step:1,size:"small"}),(0,c.jsx)(a.Select,{"data-testid":"rrule-prop-freq",value:r,options:u.Ws,onChange:s,styles:{size:"tiny",minWidth:35}})]})};var F=n(85577);const L=v(),H=(0,D.o)((0,S.W)(L,{years:1})),q=e=>{let{option:t,item:n,onChange:s,children:o}=e;const{value:r,label:i}=n,d=t==r,u=(0,l.useCallback)((()=>{s(r)}),[r,s]);return(0,c.jsxs)(a.Flex,{gap:2,alignItems:"center",children:[(0,c.jsx)(a.RadioButton,{checked:d,onChange:u}),(0,c.jsx)(a.TextSmall,{children:i}),"function"===typeof o?o({isDisabled:!d}):o]})},N=e=>{let{option:t,count:n,until:s,onRecurrenceEndChange:o,onEndDateChange:r,onCountChange:i}=e;const d=(0,A.rW)("offset"),h=(0,l.useMemo)((()=>s?`${(0,F.GP)(new Date(s),"dd/MM/yyyy HH:mm")} UTC${d}`:"specific date"),[s,d]);return(0,c.jsxs)(a.Flex,{column:!0,gap:2,children:[(0,c.jsx)(a.TextSmall,{children:"Ends"}),(0,c.jsx)(q,{option:t,item:u.u7.never,onChange:o}),(0,c.jsx)(q,{option:t,item:u.u7.on,onChange:o,children:e=>{let{isDisabled:t}=e;return t?(0,c.jsx)(a.TextSmall,{color:"textLite",children:h}):(0,c.jsx)(C.A,{isSinglePicker:!0,values:{singleDate:s},minDate:L,maxDate:H,utc:d,onChange:r,isPlaying:!1,accessorProps:u.Iv,padding:[4,0],width:"auto",accessorTooltipContent:"Select end date"})}}),(0,c.jsx)(q,{option:t,item:u.u7.after,onChange:o,children:e=>{let{isDisabled:t}=e;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(a.TextInput,{"data-testid":"rrule-prop-count",width:20,value:n,onChange:i,type:"number",min:1,step:1,size:"small",disabled:t}),(0,c.jsx)(a.TextSmall,{children:"occurence(s)"})]})}})]})};var P=n(41395);const M=e=>{let{rruleState:t,rruleText:n,rruleHandlers:l}=e;const{simpleFreq:s,freq:o,interval:r,endsOption:i,count:d,until:u}=t||{},{isCustomRule:h,onSimpleFreqChange:p,onFreqChange:g,onIntervalChange:m,onRecurrenceEndChange:x,onEndDateChange:b,onCountChange:C}=l||{};return(0,c.jsxs)(a.Flex,{column:!0,gap:3,children:[(0,c.jsx)(T,{value:s||"",onChange:p}),n?(0,c.jsx)(a.Text,{color:"primary",children:(0,P.Zr)(n)}):null,h?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(w,{freq:o,interval:r,onFreqChange:g,onIntervalChange:m}),(0,c.jsx)(N,{option:i,count:d,until:u,onRecurrenceEndChange:x,onEndDateChange:b,onCountChange:C})]}):null]})};function U(e){return(0,D.o)(Date.now(),e)}var W=n(64587);const B=U(),_=v(),Y=v(),z=(0,D.o)((0,S.W)(Y,{years:1})),$=e=>{let{start:t,end:n,onChange:a,isEdit:s}=e;const[o,r]=(0,l.useState)(s?"schedule":u.SX),[i,d]=(0,l.useState)(u.DK),[c,h]=(0,l.useState)(0),p=(0,A.rW)("offset"),[g,m]=(0,l.useState)(t?new Date(t):s?null:B),[x,b]=(0,l.useState)(n?new Date(n):s?null:_),[C,f]=(0,l.useState)((0,D.o)((0,S.W)(g,{days:1}))),{utcOffset:j}=(0,W.$j)(g),{utcOffset:v}=(0,W.$j)(x);(0,l.useEffect)((()=>{const e=(0,S.W)(g,{days:1});f(e),!s&&g>=x&&b(e)}),[g]),(0,l.useEffect)((()=>{a({start:g,end:x,scheduleOption:o,duration:i})}),[g,x,o,i]);const R=(0,l.useCallback)(((e,t)=>{m(e),t||h((e=>e+1))}),[m,h]),y=(0,l.useCallback)((e=>{b(e)}),[b]),E=(0,l.useCallback)((e=>{R(Date.now()),y(e)}),[R,y]),I=(0,l.useMemo)((()=>j!=v),[j,v]);return{scheduleOption:o,setScheduleOption:r,duration:i,setDuration:d,setCustomDuration:E,startDate:g,endDate:x,inOneYear:z,offset:p,onStartDateChange:R,onEndDateChange:y,forceRenderEndDate:c,minEndDate:C,dst:I}},V=e=>{let{dst:t}=e;return t?(0,c.jsxs)(a.Flex,{gap:2,alignItems:"center",children:[(0,c.jsx)(a.Icon,{name:"warning_triangle",color:"warning"}),(0,c.jsx)(a.TextSmall,{children:"UTC offeset difference exists between selected dates due to Daylight Saving Time (DST)."})]}):null},K=e=>{let{start:t,end:n,rruleState:l,rruleText:s,rruleHandlers:o,onChange:r,isDisabled:i,isEdit:h}=e;const{scheduleOption:p,setScheduleOption:g,duration:m,setDuration:x,setCustomDuration:b,startDate:C,endDate:f,inOneYear:j,offset:v,onStartDateChange:D,onEndDateChange:S,forceRenderEndDate:A,minEndDate:R,dst:y}=$({start:t,end:n,onChange:r,isEdit:h});return(0,c.jsxs)(a.Flex,{column:!0,gap:3,children:[(0,c.jsx)(V,{dst:y}),!h&&(0,c.jsx)(a.Flex,{gap:3,children:Object.entries(u.Yo).map((e=>{let[t,{text:n,tooltip:l}]=e;return(0,c.jsx)(a.RadioButton,{checked:t===p,onChange:()=>g(t),disabled:i,children:(0,c.jsx)(d.A,{content:l,align:"bottom",children:(0,c.jsx)(a.TextSmall,{color:"textDescription",children:n})})},t)}))}),"now"===p?(0,c.jsx)(I,{duration:m,setDuration:x,setDate:b,endDate:f,isDisabled:i}):(0,c.jsxs)(a.Flex,{column:!0,gap:2,children:[(0,c.jsx)(k,{startDate:C,startOfToday:U,onStartDateChange:D,endDate:f,minEndDate:R,onEndDateChange:S,inOneYear:j,offset:v,forceRenderEndDate:A}),(0,c.jsx)(M,{rruleState:l,rruleText:s,rruleHandlers:o})]})]})},G=e=>{let{content:t="Loading alerts..."}=e;return(0,c.jsx)(a.Flex,{height:45,alignItems:"center",justifyContent:"center",children:(0,c.jsx)(a.Text,{children:t})})};const J=(0,n(5331).VF)(),Z=()=>(0,c.jsxs)(a.Text,{color:"textLite",children:["Timezone: ",J]});var Q=n(60670),X=(n(8872),n(15920)),ee=n(89942),te=n(46587),ne=n(99728),le=n(24609),ae=n(83268),se=n(49635),oe=n(81391),re=n(30811),ie=n(92068),de=n(52035),ue=n(34843),ce=n(84929),he=n(1705);const pe=(0,ce.Iz)((e=>(0,de.eU)((()=>(0,he.z5)(e)))));var ge=n(19075),me=n(41258),xe=n(76571),be=n(11409),Ce=n(89544),fe=n(63872),je=n(92255);const ve=e=>{const t=new Date(e),n=t.getUTCFullYear(),l=t.getUTCMonth()+1,a=t.getUTCDate(),s=t.getUTCHours(),o=t.getUTCMinutes();return(0,je.w$)(n,l,a,s,o)},De={simpleFreq:u.hq.value,freq:u.T6.day,interval:1,count:1,until:void 0,endsOption:u.GB},Se={[u.T6.day]:je.p3.DAILY,[u.T6.week]:je.p3.WEEKLY,[u.T6.month]:je.p3.MONTHLY,[u.T6.year]:je.p3.YEARLY},Ae=e=>{let{state:t,startDate:n,endDate:a,onRRuleChange:s,onRRuleTextChange:o,onRRuleStateChange:r}=e;(0,l.useEffect)((()=>{if(t.simpleFreq===u.hq.value)return s(""),void o("");const e=new je.p3({freq:Se[t.freq],dtstart:ve(n),..."custom"===t.simpleFreq?{interval:t.interval}:{},..."custom"===t.simpleFreq&&t.endsOption===u.Pu.on&&t.until?{until:ve(t.until)}:{},..."custom"===t.simpleFreq&&t.endsOption===u.Pu.after&&t.count?{count:t.count}:{}});s(e.toString()),o(e.toText())}),[t,n,a,s,o]);const i=(0,l.useCallback)((e=>{let{value:t}=e;r({simpleFreq:t,freq:"custom"===t?u.T6.day:t})}),[r]),d=(0,l.useCallback)((e=>{let{value:t}=e;r({freq:t})}),[r]),c=(0,l.useCallback)((e=>{let{target:t}=e;r({interval:t?.value})}),[r]),h=(0,l.useCallback)((e=>{r({endsOption:e})}),[r]),p=(0,l.useCallback)((e=>{r({until:e})}),[r]),g=(0,l.useCallback)((e=>{let{target:t}=e;r({count:t?.value})}),[r]);return{isCustomRule:"custom"===t.simpleFreq,onSimpleFreqChange:i,onFreqChange:d,onIntervalChange:c,onRecurrenceEndChange:h,onEndDateChange:p,onCountChange:g}},Re={name:"",rooms:[],nodes:[],hostLabels:null,alertNames:[],alertContexts:[],alertRoles:[],integrationIds:[],startsAt:null,lastsUntil:null,rrule:null,rruleState:De},ye=e=>{let{id:t,name:n,...l}=e;return{label:n,value:t,...l}},Ee=e=>({label:e,value:e}),Ie=e=>{let{rooms:t,nodes:n,hostLabels:l,startsAt:a,lastsUntil:s,...o}=e;const r=o.rrule?(e=>{if(!e)return null;try{const{options:t}=(0,je.YI)(e);return{...t,simpleFreq:t.interval&&t.interval>1||t.count||t.until?"custom":je.p3.FREQUENCIES[t.freq],freq:je.p3.FREQUENCIES[t.freq],interval:t.interval||"",count:t.count||"",until:t.until||"",endsOption:t.until?u.Pu.on:t.count?u.Pu.after:u.Pu.never}}catch(t){return null}})(o.rrule):De;return{...o,scope:o.accountId?"personal":u._V,canSubmit:!!o?.name?.length,rooms:t?.length?t.map(ye):[se.PT],...n?.length?{nodes:n.map(ye).filter((e=>{let{notAvailable:t}=e;return!t}))}:{},...l?{hostLabels:l}:{},...a?{startsAt:a}:{},...s?{lastsUntil:s}:{},...r?{rruleState:r}:{}}},Oe=e=>{let{value:t}=e;return t},ke=(e,t)=>{const{scope:n,rooms:l,nodes:a,hostLabels:s,startsAt:o,lastsUntil:r,scheduleOption:i,duration:d,rrule:c,rruleState:h,rruleText:p,...g}=e,m=l.filter((e=>{let{value:t}=e;return t!==u.jH.value})).map(Oe),x=a.map(Oe),b=!!Object.keys(s||{}).length,{start:C,end:f}=(e=>{let{startsAt:t,lastsUntil:n,scheduleOption:l,duration:a}=e;if("schedule"===l)return{start:t,end:n};let s,o=Date.now();switch(a){case"oneHour":s=(0,S.W)(o,{hours:1});break;case"sixHours":s=(0,S.W)(o,{hours:6});break;case"twelveHours":s=(0,S.W)(o,{hours:12});break;case"oneDay":s=(0,S.W)(o,{days:1});break;case"custom":s=n}return{start:o,...s?{end:s}:{}}})({startsAt:o,lastsUntil:r,scheduleOption:i,duration:d});return{...g,..."personal"===n?{account_id:t}:{},...m.length?{room_ids:m}:{},...x.length?{node_ids:x}:{},...b?{host_labels:s}:{},starts_at:new Date(C).toISOString(),...f?{lasts_until:new Date(f).toISOString()}:{},...h.simpleFreq!==u.hq.value?{rrule:c}:{}}},Te=[{label:"CRITICAL",value:"CRITICAL"},{label:"WARNING",value:"WARNING"},{label:"CLEAR",value:"CLEAR"}],we=e=>{let{rule:t,onClose:n,isEdit:a}=e;const s=(0,te.NJ)(),o=(0,X.Zp)(),r=(0,le.bq)(),[i,d]=(0,g.A)(),c=(0,oe.A)({all:!0}),h=c.find((e=>{let{label:t}=e;return"All nodes"===t}))?.value,{loaded:p,value:m,hasError:x}=(()=>{const e=(0,le.vt)(),t=(0,ue.md)((0,ce.Rq)(pe(e)));return{loaded:"loading"!==t.state,value:t.data?.data||he.rx,hasError:"hasError"===t.state}})(),b=(0,ie._B)(),C=(0,ie.FU)(),f=a?C:b,j=(0,re.l)(),v=(0,ie.Lz)(),[,,D]=(0,fe.A)(),[S,A]=(0,l.useState)({alertNameOptions:[],alertContextOptions:[],alertRoleOptions:[]}),{alertNameOptions:R,alertContextOptions:y,alertRoleOptions:E}=S,I=(0,le.vt)();(0,me.A)(I,"modal");const[O,k]=(0,l.useState)([]),{loaded:T,loading:w,channels:F,error:L}=(0,xe.t5)(I);(0,l.useEffect)((()=>{if(!w&&T&&!L){const e=F.reduce(((e,t)=>{let{enabled:n,name:l,integration:a}=t;return[...e,...n?[{value:a.id,label:`${l||""} (${a.title})`}]:[]]}),[]);k(e)}}),[w,T,F,L,k]);const[H,q]=(0,l.useState)((()=>({...Re,...Ie(t)}))),[N,P]=(0,l.useState)([]),{loaded:M,value:U}=(0,ge.I8)({alertNames:H.alertNames,contexts:H.alertContexts,allowEmptyName:!0});(0,l.useEffect)((()=>{const e=(U||[]).filter((e=>!((H.alertNames||[]).length&&!H.alertNames.includes(e.name))&&(!((H.alertContexts||[]).length&&!H.alertContexts.includes(e.context))&&!((H.nodeIds||[]).length&&!H.nodeIds.includes(e.nodeId))))).map((e=>{let{instance:t,instanceName:n}=e;return{value:t,label:n}}));P(e)}),[M,U,H.alertNames,H.alertContexts,H.nodeIds]);const W=(0,ae.vv)(H.roomIds||[h]),B=(0,l.useCallback)((e=>q((t=>({...t,scope:e})))),[q]),_=(0,l.useCallback)((e=>q((t=>({...t,name:e,canSubmit:!!e?.length})))),[q]),Y=(0,l.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const n=(e=>e.length<=1?e:e[e.length-1].value===u.jH.value?[u.jH]:e.filter((e=>{let{value:t}=e;return!!t})))(e),l=n.map((e=>{let{value:t}=e;return t||h})),a=t.length<n.length?n.filter((e=>{let{value:n}=e;return!t.includes(n)}))[0]:null;q((e=>({...e,rooms:n,roomIds:l,lastRoomAdded:a||null})))}),[h,q]),z=(0,l.useCallback)((e=>q((t=>({...t,nodeIds:e.map((e=>{let{value:t}=e;return t})),nodes:e})))),[q]),$=(0,l.useCallback)((e=>q((t=>({...t,hostLabels:{...t.hostLabels,...e}})))),[q]),V=(0,l.useCallback)((e=>q((t=>{const n={...t.hostLabels};return delete n[e],{...t,hostLabels:n}}))),[q]),K=(0,l.useCallback)((e=>t=>q((n=>({...n,[e]:t.map((e=>{let{value:t}=e;return t}))})))),[q]),G=(0,l.useCallback)((e=>q((t=>({...t,integrationIds:e.map((e=>{let{value:t}=e;return t}))})))),[q]),J=(0,l.useCallback)((e=>{let{start:t,end:n,scheduleOption:l,duration:a}=e;return q((e=>({...e,startsAt:t,lastsUntil:n,scheduleOption:l,duration:a.value})))}),[q]),Z=(0,l.useCallback)((e=>{q((t=>({...t,rrule:e})))}),[q]),Q=(0,l.useCallback)((e=>{q((t=>({...t,rruleText:e})))}),[q]),se=(0,l.useCallback)((e=>{q((t=>({...t,rruleState:{...t.rruleState,...e}})))}),[q]),de=(0,l.useCallback)((()=>{d(),f(ke(H,s)).then((()=>{n(),v(),j()})).catch((e=>D((0,be.H)(e)))).finally(d)}),[H,s]),je=(0,Ce.A)();(0,l.useEffect)((()=>{const e=H.lastRoomAdded?.value||h;let t=null;return e&&(t=je(e)),()=>!!t?.cancel&&t.cancel()}),[H.roomIds,je]),(0,l.useEffect)((()=>{if(p){const{contexts:e,names:t,roles:n}=m||{};A({alertNameOptions:t?t.map(Ee):[],alertContextOptions:e?e.map(Ee):[],alertRoleOptions:n?n.map(Ee):[]})}}),[p]),(0,l.useEffect)((()=>{const e=(0,ee.PP)(),t=(()=>{const{silencingRulePrefill:e}=(0,ee.PP)();if(!e)return{};let t={};try{t=JSON.parse(e)}catch{}return t})(),{alertName:n,nodeId:l,context:a,instance:s,roomId:o}=t;if(o){const e=c.filter((e=>{let{value:t}=e;return t===o}));e&&Y(e)}if(n&&q((e=>({...e,alertNames:[n]}))),a&&q((e=>({...e,alertContexts:[a]}))),s&&q((e=>({...e,alertInstances:[s]}))),l){const e=W.filter((e=>{let{value:t}=e;return t===l}));e&&z(e)}(0,ee.Z8)({...e,silencingRulePrefill:""})}),[q,K,z,W]);const ve=(0,ne.JT)("space:CreatePersonalSilencingRule"),De=(0,l.useCallback)((()=>o(`/spaces/${r}/settings/billing`)),[r,o]),Se=Ae({state:H.rruleState,startDate:H.startsAt,endDate:H.lastsUntil,onRRuleChange:Z,onRRuleTextChange:Q,onRRuleStateChange:se});return{state:H,onScopeChange:B,onRuleNameChange:_,onRoomsSelectionChange:Y,roomOptions:c,onNodesSelectionChange:z,nodesOptions:W,alertMetasLoaded:p,alertMetas:m,alertNameOptions:R,alertContextOptions:y,alertInstancesEnabled:!0,alertInstancesOptions:N,alertRoleOptions:E,alertStatusOptions:Te,channelsOptions:O,alertMetasError:x,onAlertValueChange:K,onIntegrationsValueChange:G,onAddHostLabel:$,onRemoveHostLabel:V,onDatesChange:J,loading:i,onSave:de,spaceCreatePersonalSilencingRule:ve,onUpdateButtonClick:De,rruleHandlers:Se}},Fe=e=>e?.length?e.map(Ee):[],Le=()=>(0,c.jsx)(a.Box,{as:"hr",height:"1px",width:"100%",sx:{borderWidth:"1px 0px 0px 0px",borderColor:"borderSecondary",borderStyle:"solid"}}),He=e=>{let{rule:t={},onClose:n,isEdit:r}=e;const{state:i,onScopeChange:u,onRuleNameChange:g,onRoomsSelectionChange:m,roomOptions:x,onNodesSelectionChange:C,nodesOptions:f,alertMetasLoaded:j,alertNameOptions:v,alertContextOptions:D,alertInstancesEnabled:S,alertInstancesOptions:A,alertRoleOptions:R,alertStatusOptions:y,channelsOptions:E,onAlertValueChange:I,onIntegrationsValueChange:O,onAddHostLabel:k,onRemoveHostLabel:T,onDatesChange:w,loading:F,onSave:L,spaceCreatePersonalSilencingRule:H,onUpdateButtonClick:q,rruleHandlers:N}=we({rule:t,onClose:n,isEdit:r}),P=(0,l.useMemo)((()=>`${r?"Edit":"Add"} silencing rule`),[r]),M=(0,l.useCallback)((()=>E.filter((e=>{let{value:t}=e;return i.integrationIds.includes(t)}))),[i.integrationIds,E]);return(0,c.jsx)(a.Modal,{onEsc:n,backdropProps:{backdropBlur:!0},children:(0,c.jsxs)(o.$m,{children:[(0,c.jsx)(a.ModalHeader,{padding:[6,4,3],children:(0,c.jsxs)(a.Flex,{column:!0,gap:2,children:[(0,c.jsxs)(a.Flex,{flex:!0,alignItems:"center",justifyContent:"between",children:[(0,c.jsx)(a.H4,{children:P}),n&&(0,c.jsx)(o.Oj,{onClose:n})]}),(0,c.jsxs)(a.Text,{children:["Define an alert notification silencing rule that will apply to all users or just you."," ",(0,c.jsx)(s.A,{"data-ga":"alert-silencing::click-link-docs::rule-modal","data-testid":"silencing-rules-doc",href:"https://learn.netdata.cloud/docs/alerts-&-notifications/notifications/centralized-cloud-notifications/manage-alert-notification-silencing-rules",rel:"noopener noreferrer",target:"_blank",children:"Learn how to configure silencing rules."})]}),!H&&(0,c.jsx)(Q.A,{})]})}),(0,c.jsx)(a.ModalBody,{padding:[0],overflow:{vertical:"auto"},style:{maxHeight:"800px"},children:(0,c.jsx)(o.fn,{children:(0,c.jsxs)(a.Flex,{column:!0,gap:3,children:[(0,c.jsx)(h,{scope:i.scope,setScope:u,padding:[0,0,1,0],isDisabled:!H}),(0,c.jsx)(p.A,{component:"input",onChange:g,placeholder:"Add rule name",title:"Rule name*",value:i.name,disabled:!H}),(0,c.jsx)(p.A,{component:"select",isMulti:!0,onChange:e=>m(e,i.roomIds),options:x,placeholder:"Select rooms",title:"Rooms*",value:i.rooms,isDisabled:!H}),(0,c.jsx)(p.A,{component:"select",isMulti:!0,onChange:C,options:f,placeholder:"Select nodes",title:"Nodes",value:i.nodes,isDisabled:!H||!f.length}),(0,c.jsx)(b,{hostLabels:i.hostLabels,onAddHostLabel:k,onRemoveHostLabel:T,isEdit:r,isDisabled:!H}),j?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(Le,{}),(0,c.jsx)(p.A,{component:"select",isMulti:!0,onChange:I("alertNames"),options:v,placeholder:"Select alert name",title:"Alert name",value:Fe(i.alertNames),isDisabled:!H}),(0,c.jsx)(p.A,{component:"select",isMulti:!0,onChange:I("alertContexts"),options:D,placeholder:"Select alert context",title:"Alert context",value:Fe(i.alertContexts),isDisabled:!H}),(0,c.jsx)(p.A,{component:"select",isMulti:!0,onChange:I("alertInstances"),options:A,placeholder:"Select alert instance",title:"Alert instance",value:Fe(i.alertInstances),isDisabled:!H||!S}),(0,c.jsx)(p.A,{component:"select",isMulti:!0,onChange:I("severities"),options:y,placeholder:"Select alert status",title:"Alert status",value:Fe(i.severities),isDisabled:!H}),(0,c.jsx)(p.A,{component:"select",isMulti:!0,onChange:I("alertRoles"),options:R,placeholder:"Select alert role",title:"Alert role",value:Fe(i.alertRoles),isDisabled:!H}),(0,c.jsx)(p.A,{component:"select",isMulti:!0,onChange:O,options:E,placeholder:"Select notification methods",title:"Notification Methods",value:M(),isDisabled:!H})]}):(0,c.jsx)(G,{}),(0,c.jsx)(Le,{}),(0,c.jsx)(K,{start:i.startsAt,end:i.lastsUntil,rruleState:i.rruleState,rruleText:i.rruleText,rruleHandlers:N,onChange:w,isEdit:r,isDisabled:!H})]})})}),(0,c.jsxs)(a.ModalFooter,{alignItems:"center",justifyContent:"between",children:[(0,c.jsx)(Z,{}),(0,c.jsxs)(a.Flex,{gap:4,alignItems:"center",children:[(0,c.jsx)(a.Button,{flavour:"borderless",label:"Cancel",onClick:n,disabled:F}),H?(0,c.jsx)(d.A,{content:r?"Update the rule":"Create the rule",align:"bottom",children:(0,c.jsx)(a.Button,{label:"OK",onClick:L,"data-ga":`alert-silencing::click-save-${r?"edit":"new"}-rule::rule-modal`,"data-testid":"saveRule-button",textTransform:"uppercase",isLoading:F,disabled:F||!i.canSubmit})}):(0,c.jsx)(d.A,{content:"Update to a paid plan in order to be able to create silencing rules",align:"bottom",children:(0,c.jsx)(a.Button,{label:"Upgrade!",onClick:q})})]})]})]})})}}}]);