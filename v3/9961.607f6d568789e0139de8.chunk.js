try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="0f8fcb0d-d5db-430b-983a-4d3797b3fd49",e._sentryDebugIdIdentifier="sentry-dbid-0f8fcb0d-d5db-430b-983a-4d3797b3fd49")}catch(e){}("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:{}).SENTRY_RELEASE={id:"6f1faf434b0a85eb183c91391b598f364a828f27"};(self.webpackChunkcloud_frontend=self.webpackChunkcloud_frontend||[]).push([[9961],{11409:(e,t,a)=>{a.d(t,{H:()=>n,M:()=>r});a(98992),a(8872);var l=a(37437);const n=e=>{const{validationErrors:t,errorMessage:a}=e?.response?.data||{};return t&&Object.keys(t).length?Object.entries(t).reduce(((e,t)=>{let[,a]=t;const{code:n,message:r}=a;return l.xc[n]||r?e.push({errorMessage:l.xc[n]||r}):e.includes(l.xc.default)||e.push({errorMessage:l.xc.default}),e}),[]):[{errorMessage:a}]},r=e=>{let{key:t,value:a}=e;return`${t}: ${a}`}},19961:(e,t,a)=>{a.r(t),a.d(t,{default:()=>se});var l=a(96540),n=a(88255),r=a(55093),s=(a(98992),a(37550),a(6304)),o=a(81683),i=a(13473),d=a(27784),c=a(65258),u=(a(3949),a(8872),a(42790)),m=a(38823),h=a(64007),x=a(57714),g=a(11409),b=a(74848);const p=(e,t,a)=>{let{id:l,name:n}=e;-1==a?t.push({id:l,name:n,count:1}):t[a]={...t[a],count:t[a].count+1}},y=e=>e.id,f=e=>e.name,j=e=>{let{title:t,baseKey:a,param:n,paramKey:r,extraKey:s,testIdPrefix:o}=e;const i=(e=>{let{baseKey:t,extraKey:a,param:n,paramKey:r}=e;const{rules:s}=(0,x.q)({extraKey:a,omit:n,keepAll:!0}),o=(0,u.rW)(n,{key:t,extraKey:a,flavour:"arr"});return(0,l.useMemo)((()=>s.reduce(((e,t)=>{const a=t[r];if(!a)return e;const l=e.findIndex((e=>e.id==a.id));return"id"==r?p({id:a,name:a},e,l):["rooms","nodes"].includes(r)?a.forEach((t=>{let{id:a,name:n,notAvailable:r}=t;p({id:a,name:r?`Not available (${a})`:n},e,l)})):["alertNames","alertContexts","alertRoles"].includes(r)?a.forEach((t=>{p({id:t,name:t},e,l)})):"hostLabels"==r&&Object.entries(a).forEach((t=>{let[a,n]=t;const r=(0,g.M)({key:a,value:n});p({id:r,name:r},e,l)})),e}),[])),[s,o])})({baseKey:a,extraKey:s,param:n,paramKey:r});return i.length?(0,b.jsx)(m.A,{title:t,testIdPrefix:o,param:n,baseKey:a,extraKey:s,children:(0,b.jsx)(h.Ay,{param:n,baseKey:a,extraKey:s,testIdPrefix:o,collection:i,getValue:y,getLabel:f,capitalized:!1})}):null};var A=a(24609),w=a(37437);const K=[{title:"Rules IDs",param:"ids",paramKey:"id"},{title:"Rooms",param:"roomIds",paramKey:"rooms"},{title:"Nodes",param:"nodeIds",paramKey:"nodes"},{title:"Host labels",param:"hostLabels",paramKey:"hostLabels"},{title:"Alert names",param:"alertNames",paramKey:"alertNames"},{title:"Alert contexts",param:"alertContexts",paramKey:"alertContexts"},{title:"Alert roles",param:"alertRoles",paramKey:"alertRoles"}],v={filters:{iconName:"filterList",color:{active:"success",notActive:"textLite"},width:"19px",Content:(0,l.memo)((e=>{const t=(0,A.vt)();return(0,b.jsx)(c.Flex,{column:!0,height:"calc(100vh - 266px)",overflow:{vertical:"auto"},padding:[0,0,30],...e,children:K.map((e=>{let{title:a,param:l,paramKey:n}=e;return(0,b.jsx)(j,{baseKey:t,extraKey:w.qt,title:a,param:l,paramKey:n},a)}))})})),dataTestId:"filterBar",label:"Filters"}},k=["filters"],C=e=>e.some((e=>{let{roomIds:t=[],nodeIds:a=[],hostLabels:l={},alertNames:n=[],alertContexts:r=[],alertRoles:s=[]}=e;return t.length||a.length||Object.keys(l).length||n.length||r.length||s.length})),T=e=>{let{rules:t}=e;const[a,n]=(0,s.A)((()=>C(t))),{Content:r}=v.filters;return(0,l.useEffect)((()=>{n(C(t))}),[t]),(0,b.jsx)(o.Ay,{collapsedComponent:(0,b.jsx)(i.A,{onClickTab:n,availableTabs:v,tabsToShow:k}),isOpen:a,header:(0,b.jsx)(d.A,{isOpen:a,onToggle:n,title:"Filters",icon:"filterList"}),children:(0,b.jsx)(r,{padding:[0,3,30]})})};var S=a(7960),I=a(79748),F=a(57377),L=(a(54520),a(81454),a(30569)),R=a(64587),D=a(92068),N=a(63872),M=a(73613),E=a(75894),P=a(15679);const $=()=>(0,b.jsx)(c.Text,{children:"*"}),O=e=>{let{getValue:t}=e;const a=t();return a?.length?(0,b.jsx)(c.Flex,{flexWrap:!0,gap:1,children:a.map((e=>(0,b.jsx)(c.Flex,{padding:[.5,0],children:(0,b.jsx)(P.A,{value:e})},e)))}):(0,b.jsx)($,{})},V=e=>{let{getValue:t}=e;const{localeDateString:a}=(0,R.$j)();if(!t())return(0,b.jsx)(c.Text,{children:"-"});const l=a(new Date(t()),{month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",long:!1,dateStyle:void 0});return(0,b.jsx)(c.Text,{whiteSpace:"nowrap",children:l})},_=[{id:"name",desc:!0}],H=[{id:"disabled",name:"Disable rule",accessorKey:"disabled",header:"",cell:e=>{let{row:t,getValue:a}=e;const n=(0,A.vt)(),r=t.original,[o,i]=(0,l.useState)(!a()),[d,u]=(0,s.A)(),[,m]=(0,N.A)(),h=(0,D.FU)(),x=(0,L.yF)((0,l.useCallback)(((e,t,a)=>{t((0,D.Pu)({id:n,key:"rules"}),(e=>[...e.filter((e=>e.id!=a.id)),a]))}),[n]));return(0,b.jsx)(c.Toggle,{colored:!0,checked:o,disabled:d,onChange:e=>{u();const t=e.target.checked;i(t);const a={...r,disabled:!t};h(a).then((()=>{x(a)})).catch((e=>{i(!t),m(e)})).finally(u)}})},size:80},{id:"name",name:"Name",accessorKey:"name",header:"Rule name",cell:e=>{let{row:t,getValue:a}=e;const{accountId:l}=t.original;return(0,b.jsxs)(c.Flex,{gap:2,alignItems:"center",children:[(0,b.jsx)(c.Text,{wordBreak:"break-word",children:a()}),l&&(0,b.jsx)(M.A,{align:"bottom",content:"This rule affects only your account",children:(0,b.jsx)(c.Box,{children:(0,b.jsx)(c.Icon,{color:"textLite",height:"16px",name:"userPress",width:"16px"})})})]})}},{id:"rooms",name:"Rooms",accessorKey:"rooms",header:"Rooms",cell:e=>{let{getValue:t}=e;const a=t();return a?.length?(0,b.jsx)(c.Text,{children:a.map((e=>{let{name:t}=e;return t})).join(", ")}):(0,b.jsx)(c.Text,{children:"All rooms"})}},{id:"nodes",name:"Nodes",accessorKey:"nodes",header:"Nodes",cell:e=>{let{getValue:t}=e;const a=t();return a?.length?(0,b.jsx)(c.Flex,{flexWrap:!0,gap:1,children:a.map((e=>{let{id:t,name:a,notAvailable:l}=e;const n=l?(0,b.jsxs)(c.Flex,{alignItems:"center",gap:1,children:[(0,b.jsx)(c.Icon,{name:"warning_triangle",size:"small",color:"neutralPillColor"}),(0,b.jsx)(c.Text,{children:"Node no longer available"})]}):a;return(0,b.jsx)(P.A,{value:n},t)}))}):(0,b.jsx)($,{})}},{id:"hostLabels",name:"Host labels",accessorKey:"hostLabels",header:"Host labels",cell:e=>{let{getValue:t}=e;const a=t(),l=Object.entries(a||{});return l.length?(0,b.jsx)(c.Flex,{flexWrap:!0,gap:1,children:l.map((e=>{let[t,a]=e;const l=(0,g.M)({key:t,value:a});return(0,b.jsx)(P.A,{value:l},l)}))}):(0,b.jsx)($,{})}},{id:"alertNames",name:"Alert names",accessorKey:"alertNames",header:"Alert name",cell:O},{id:"alertContexts",name:"Alert contexts",accessorKey:"alertContexts",header:"Alert context",cell:O},{id:"alertInstances",name:"Alert instances",accessorKey:"alertInstances",header:"Alert instances",cell:O},{id:"severities",name:"Alert status",accessorKey:"severities",header:"Alert status",cell:e=>{let{getValue:t}=e;const a=t();return a?.length?(0,b.jsx)(c.Flex,{flexWrap:!0,gap:1,children:a.map((e=>(0,b.jsx)(c.Flex,{padding:[.5,0],children:(0,b.jsx)(E.A,{flavour:e.toLowerCase(),children:e})},e)))}):(0,b.jsx)($,{})}},{id:"alertRoles",name:"Alert roles",accessorKey:"alertRoles",header:"Alert role",cell:O},{id:"startDate",name:"Start date",accessorKey:"startsAt",header:"Start date",cell:V},{id:"endDate",name:"End date",accessorKey:"lastsUntil",header:"End date",cell:V}];var B=a(89942),U=a(30811),W=a(99728);const q={month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",long:!1,dateStyle:void 0},z=()=>{const[e,t]=(0,l.useState)(""),{silencingRulePrefill:a}=(0,B.PP)(),n=a?{type:"create"}:{},[r,s]=(0,l.useState)(n),[,o]=(0,N.A)(),{localeDateString:i}=(0,R.$j)(),d=(0,D._S)(),u=(0,D.Lz)(),m=(0,U.l)(),h=()=>s({type:"create"}),x=e=>s({type:"edit",rule:e}),g=e=>{let{id:t}=e;d([t]).then((()=>{u(),m()})).catch(o)},p=(0,W.JT)("space:DeletePersonalSilencingRule"),y=(0,W.JT)("space:DeleteSystemSilencingRule"),f=(0,l.useMemo)((()=>({addEntry:{dataGa:"",flavour:"hollow",handleAction:h,iconColor:"success",label:"Add rule",small:!0,width:"auto"}})),[]),j=e=>{let{name:t}=e;return(0,b.jsxs)(b.Fragment,{children:["Delete ",t," rule"]})};return{search:e,setSearch:t,bulkActions:f,rowActions:(0,l.useMemo)((()=>({edit:{handleAction:x,disabledTooltipText:"Edit is disabled",isDisabled:e=>{let{readOnly:t}=e;return!!t},dataGa:"alert-silencing::click-edit-row::rules-table"},delete:{handleAction:g,confirmationTitle:j,confirmationMessage:e=>(0,b.jsxs)(c.Text,{wordBreak:"break-word",children:["You are about to delete ",(0,b.jsx)("strong",{children:e.name})," silencing rule.",(0,b.jsx)("br",{}),"Are you sure you want to continue?"]}),dataGa:"alert-silencing::click-delete-row::rules-table",disabledTooltipText:"Delete is disabled",confirmLabel:"Yes, delete",declineLabel:"Cancel",isDisabled:e=>{let{accountId:t}=e;return t?!p:!y}}})),[]),onFilter:(0,l.useCallback)(((e,t,a)=>{const l=e.original,n=a.toLowerCase(),r=(l.rooms||[]).map((e=>{let{name:t}=e;return t})),s=(l.nodes||[]).map((e=>{let{name:t}=e;return t})),o=l.alertNames||[],d=l.alertContexts||[],c=l.severities||[],u=l.alertRoles||[],m=l.hostLabels||{},h=l.startsAt?i(new Date(l.startsAt),q):"",x=l.lastsUntil?i(new Date(l.lastsUntil),q):"";return((e,t)=>e.some((e=>e.toLowerCase().includes(t))))([l.name.toLowerCase(),...r,...s,...o,...d,...c,...u,...Object.entries(m).flat(),h,x],n)}),[]),modalDetails:r,closeModal:()=>s({})}},J=(0,S.A)((()=>a.e(6571).then(a.bind(a,66571))),"CreateOrUpdateRuleModal"),G=(0,l.memo)(c.Table,((e,t)=>(0,F.Ay)(e,t))),Y={right:["actions"]},Q=()=>(0,b.jsx)(c.Flex,{children:(0,b.jsxs)(c.Text,{children:["Create or Maintain Alert Notification Silencing Rules on this Space. These rules can be applicable to all users or just you, depending on their definition."," ",(0,b.jsx)(I.A,{"data-ga":"alert-silencing::click-link-docs::rules-table","data-testid":"silencing-rules-doc",href:"https://learn.netdata.cloud/docs/alerts-and-notifications/notifications/netdata-cloud-notifications/#silencing-alert-notifications",rel:"noopener noreferrer",target:"_blank",children:"Read the Alert Notification Silencing Rules documentation to learn more."})]})}),X=e=>{let{data:t}=e;const{search:a,setSearch:n,bulkActions:r,rowActions:s,onFilter:o,modalDetails:i,closeModal:d}=z();return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(c.Flex,{column:!0,gap:4,padding:[2,4],height:"100%",children:[(0,b.jsx)(Q,{}),(0,b.jsx)(G,{enableSorting:!0,enableColumnVisibility:!0,data:t,dataColumns:H,bulkActions:r,rowActions:s,globalFilter:a,globalFilterFn:o,onSearch:n,columnPinning:Y,enableColumnPinning:!0,sortBy:_},JSON.stringify(t||{}))]}),"create"==i.type?(0,b.jsx)(l.Suspense,{children:(0,b.jsx)(J,{onClose:d})}):null,"edit"==i.type&&i.rule?(0,b.jsx)(l.Suspense,{children:(0,b.jsx)(J,{rule:i.rule,onClose:d,isEdit:!0})}):null]})};var Z=a(36710),ee=a(49910),te=a(32052);const ae=()=>{const e=(0,A.vt)(),t=(0,D.ys)({key:"initialLoad"}),a=(0,D.Qu)(),l=(0,D.UJ)();(0,te.A)((()=>({enabled:!!e&&!t,fetch:()=>(0,Z.cH)(e),onFail:e=>l({...ee.$,loading:!1,loaded:!0,error:e}),onSuccess:e=>l({...ee.$,loading:!1,loaded:!0,initialLoad:!0,rules:e})})),[e,t,a])},le=e=>{let{errorMessage:t}=e;return(0,b.jsxs)(c.Flex,{column:!0,gap:2,alignItems:"center",justifyContent:"center",flex:!0,children:[(0,b.jsx)(c.TextBig,{children:"Something went wrong"}),t&&(0,b.jsxs)(c.Text,{children:["(",t,")"]})]})};var ne=a(89544),re=a(60908);const se=()=>{ae(),(0,ne.H)();const{loaded:e,rules:t,error:a}=(0,x.q)({extraKey:w.qt});return e?a?(0,b.jsx)(re.DL,{tab:"Notifications::SilencingRules",children:(0,b.jsx)(le,{errorMessage:a.message})}):(0,b.jsx)(re.Ay,{tab:"Notifications::SilencingRules",children:(0,b.jsx)(n.A,{sidebar:(0,b.jsx)(T,{rules:t}),children:(0,b.jsx)(X,{data:t})})}):(0,b.jsx)(r.A,{title:"Loading silencing rules..."})}},89544:(e,t,a)=>{a.d(t,{A:()=>u,H:()=>c});a(98992),a(81454);var l=a(96540),n=a(30569),r=a(24609),s=a(83268),o=a(258),i=a(81391);const d=()=>{const e=(0,r.vt)();return(0,n.yF)((0,l.useCallback)((async(t,a,l)=>{const n=await t((0,s.$6)({id:l,key:"nodes"}));let r=null;return n?.length||(a((0,s.$6)({id:l,key:"loaded"}),!1),r=(0,o.uQ)({roomId:l,spaceId:e}),r.then((e=>{let{data:t}=e;a((0,s.$6)({id:l,key:"nodes"}),t.map((e=>{let{id:t,name:a}=e;return{label:a,value:t}}))),a((0,s.$6)({id:l,key:"loaded"}),!0)})).catch((e=>a((0,s.$6)({id:l,key:"error"}),e)))),r}),[e]))},c=()=>{const e=d(),t=(0,i.n)("id");(0,l.useEffect)((()=>{let a=null;return t&&(a=e(t)),()=>!!a?.cancel&&a.cancel()}),[t,e])},u=d}}]);