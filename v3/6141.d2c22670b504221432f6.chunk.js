try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="c333bf70-23bc-4876-b099-52f7b6e58ab5",e._sentryDebugIdIdentifier="sentry-dbid-c333bf70-23bc-4876-b099-52f7b6e58ab5")}catch(e){}("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:{}).SENTRY_RELEASE={id:"6f1faf434b0a85eb183c91391b598f364a828f27"};(self.webpackChunkcloud_frontend=self.webpackChunkcloud_frontend||[]).push([[6141],{56141:(e,t,l)=>{l.r(t),l.d(t,{default:()=>D});l(98992),l(81454);var s=l(96540),n=l(63950),o=l.n(n),d=l(65258),a=l(10444),i=l(63872),r=l(3203),c=l(60908),u=l(24609),x=l(77148),h=(l(54520),l(72577),l(8872),l(33185));const g=(0,h.default)(d.MenuDropdown).attrs((e=>({background:"transparent",hideShadow:!0,height:{max:"300px"},width:{max:"600px"},overflow:"auto",padding:[2],...e}))).withConfig({displayName:"styled__CheckboxesContainer",componentId:"sc-8uj6na-0"})([""]);var f=l(50979),b=l(51262),m=l(74891),p=l(74848);const j=(0,m.A)(d.Checkbox),v=e=>{let{index:t,item:l,onItemClick:n}=e;const{group:o,label:a,value:i,node:r={}}=l,{id:c,selected:u,disabled:x}=r,{isNodeRestricted:h}=(0,b.A)(),{restricted:g,reason:m}=h(c),v=g&&"ErrNodeIsNotPreferred"!=m,y=(0,s.useMemo)((()=>v?f.KV[m]||f.KV.default:null),[v,m]),N=(0,s.useMemo)((()=>x||v),[x,v]),S=o&&t>0?[3,0,1,0]:[1,0];return(0,p.jsx)(d.Flex,{padding:S,children:o?(0,p.jsxs)(d.Flex,{gap:2,alignItems:"center",children:[(0,p.jsx)(d.Icon,{name:o.iconName,size:"small"}),(0,p.jsx)(d.Text,{color:o.textColor||"textFocus",children:o.label})]}):(0,p.jsx)(d.Flex,{children:(0,p.jsx)(j,{checked:u,disabled:N,onChange:e=>{N||n({value:i,label:a,checked:e})},label:a,value:i,labelPosition:"right",tooltip:y})})})};var y=l(28688);const N={live:{iconName:"connectivityStatusLive",label:"Live",textColor:"primary"},offline:{iconName:"connectivityStatusOffline",label:"Offline",textColor:"textFocus"},stale:{iconName:"connectivityStatusStale",label:"Stale",textColor:"textFocus"}},S=(e,t)=>t&&Object.keys(t)&&t[e]?.length?[{group:N[e]},...t[e]]:[],w=e=>{let{selectedNodes:t,setSelectedNodes:l,activeNodesLimit:n=0}=e;const{nodes:o}=(0,y.A)(),[d,a]=(0,s.useState)([]),i=(0,s.useCallback)((e=>{let{value:s,label:n,checked:o}=e;o&&!t.find((e=>e.value==s))?l((e=>[...e,{value:s,label:n}])):!o&&t.find((e=>e.value==s))&&l((e=>e.filter((e=>e.value!=s))))}),[t]);return(0,s.useEffect)((()=>{o&&a(((e,t,l)=>{const s=e.reduce(((e,s)=>{const n={...s},o=s.isLive?"live":s.isOffline?"offline":"stale";t.find((e=>{let{value:t}=e;return t==s.id}))?n.selected=!0:l==t.length&&(n.disabled=!0);const d={label:s.name,value:s.id,node:n};return e[o]?e[o]=[...e[o],d]:e[o]=[d],e}),{});return[...S("live",s),...S("offline",s),...S("stale",s)]})(o,t,n))}),[o,t]),(0,p.jsx)(g,{items:d,Item:v,onItemClick:i,searchMargin:[0,0,4,0],hasSearch:!0})};var k=l(38773),T=l(55093);const C=e=>{let{isTitle:t,value:l,selectedNodes:n,setSelectedNodes:a=o(),children:i}=e;const r=(0,s.useCallback)((()=>{t||a((e=>e.filter((e=>e.value!=l))))}),[t,l,n,a]),c={gap:1,height:"18px",alignItems:"center",padding:[0,2],margin:[0,0,2,0],round:!0,...t?{}:{background:"nodeBadgeBackground"}};return(0,p.jsxs)(d.Flex,{...c,children:[!t&&(0,p.jsx)(d.Icon,{name:"x",size:"small",onClick:r,color:"text",cursor:"pointer"}),i]})},B=e=>{let{selectedNodes:t,setSelectedNodes:l}=e;return t.length?(0,p.jsxs)(d.Flex,{flexWrap:!0,gap:2,children:[(0,p.jsx)(C,{isTitle:!0,children:(0,p.jsx)(d.TextBig,{children:"Selected Nodes:"})}),t.map((e=>{let{label:s,...n}=e;return(0,p.jsx)(C,{selectedNodes:t,setSelectedNodes:l,...n,children:(0,p.jsx)(d.TextSmall,{color:"text",children:s})},n.value)}))]}):null};var I=l(95565),F=l(39175);const A=e=>{let{selectedNodes:t,setSelectedNodes:l,loading:s,error:n}=e;const o=(0,u.vt)(),a=(0,F.ES)(o),{loaded:i,currentPlan:r,maxNodes:c}=(0,b.A)();return(0,p.jsx)(d.Flex,{column:!0,gap:4,children:s&&i?(0,p.jsx)(T.A,{height:"280px",title:"Saving selection..."}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(d.Flex,{column:!0,margin:[3,0,0,0],gap:4,children:[a?(0,p.jsxs)(d.TextBig,{children:["Local dashboard does not allow more than"," ",(0,p.jsxs)(d.TextBig,{strong:!0,children:[c," active nodes"]}),"."]}):(0,p.jsxs)(d.TextBig,{children:["Your current"," ",(0,p.jsxs)(d.TextBig,{strong:!0,children:[r.class," (",r.version,")"]})," ","plan does not allow more than ",(0,p.jsxs)(d.TextBig,{strong:!0,children:[c," active nodes"]}),"."]}),(0,p.jsxs)(d.TextBig,{children:["To proceed, select the ",(0,p.jsxs)(d.TextBig,{strong:!0,children:[c," Nodes"]})," that you wish to keep active. Any Nodes beyond this limit will be deactivated."]}),n&&(0,p.jsxs)(d.Flex,{gap:2,alignItems:"center",children:[(0,p.jsx)(d.Icon,{name:"warning_triangle",size:"medium",color:"warning"}),(0,p.jsx)(d.TextBig,{children:"For some reason, we coudn't save your selection. Please retry."})]})]}),(0,p.jsx)(x.A,{}),(0,p.jsx)(w,{selectedNodes:t,setSelectedNodes:l,activeNodesLimit:c}),(0,p.jsx)(x.A,{}),(0,p.jsxs)(d.Flex,{column:!0,gap:4,children:[(0,p.jsx)(B,{selectedNodes:t,setSelectedNodes:l}),a?(0,p.jsxs)(d.TextBig,{children:["Remember, you can"," ",(0,p.jsx)(I.A,{children:(0,p.jsx)(d.TextBig,{color:"primary",children:"upgrade your space back to the Business plan"})})," ","for unlimited access at any time."]}):null,(0,p.jsxs)(d.TextBig,{children:["The node selection isn't a commitment, you can modify the active Nodes any time on the"," ",(0,p.jsx)(k.A,{children:(0,p.jsx)(d.TextBig,{color:"primary",children:"Space Settings page"})}),"."]})]})]})})},M=(0,h.default)(d.ModalContent).attrs((e=>{let{isMobile:t}=e;return{width:t?{base:"95vw"}:{base:150}}})).withConfig({displayName:"styled__PreferredNodesModalContent",componentId:"sc-1v8zr4l-0"})([""]);var _=l(24013),E=l(30811),P=l(6304);const L=(0,r.A)(d.Button),D=e=>{let{onSuccessfulSave:t=o()}=e;const l=(0,E.l)(),n=(0,a.J)(),[r,u]=(0,i.A)(),x=(0,_.je)(),[h,g]=(0,s.useState)([]),[f,b]=(0,s.useState)(),[m,,j,v]=(0,P.A)(),y=(0,s.useCallback)((()=>{j(),x(h.map((e=>{let{value:t}=e;return t}))).then((()=>{r({header:"Success",text:"You selection was successfully saved"}),t(),l()})).catch((()=>{b(!0),u({header:"Error",text:"Selection failed to be saved"})})).finally((()=>{v()}))}),[h,x]);return(0,p.jsx)(d.Modal,{backdropProps:{backdropBlur:!0},children:(0,p.jsx)(c.Ay,{feature:"PreferredNodesModal",children:(0,p.jsxs)(M,{isMobile:n,children:[(0,p.jsx)(d.ModalHeader,{children:(0,p.jsxs)(d.Flex,{gap:2,alignItems:"center",children:[(0,p.jsx)(d.Icon,{name:"netdataPress",color:"text"}),(0,p.jsx)(d.H4,{children:"Required Action"})]})}),(0,p.jsx)(d.ModalBody,{children:(0,p.jsx)(A,{selectedNodes:h,setSelectedNodes:g,loading:m,error:f})}),!m&&(0,p.jsx)(d.ModalFooter,{children:(0,p.jsx)(d.Flex,{gap:4,justifyContent:"end",padding:[1,2],children:(0,p.jsx)(L,{feature:"SavePreferredNodes",label:"Save",onClick:y,disabled:m||!h.length,payload:{selectedNodes:h.map((e=>{let{value:t}=e;return t})).join(",")}})})})]})})})}}}]);