try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},s=(new e.Error).stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="5f420b22-f46a-4981-9fb5-87d83d50da77",e._sentryDebugIdIdentifier="sentry-dbid-5f420b22-f46a-4981-9fb5-87d83d50da77")}catch(e){}("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:{}).SENTRY_RELEASE={id:"6f1faf434b0a85eb183c91391b598f364a828f27"};(self.webpackChunkcloud_frontend=self.webpackChunkcloud_frontend||[]).push([[2248],{1457:(e,s,r)=>{r.d(s,{Rq:()=>i,oL:()=>o,u:()=>a,ue:()=>n});var l=r(52035),t=r(84929);const n={items:[],error:"",id:null,loading:!0,loaded:!1},i=(0,t.Iz)((()=>(0,l.eU)(0))),o=(0,t.Iz)((e=>(0,l.eU)({...n,id:e}))),a=(0,t.Iz)((()=>(0,l.eU)(null)))},34646:(e,s,r)=>{r.d(s,{FX:()=>n,ON:()=>o,Uj:()=>a,Zl:()=>t,lG:()=>i,lt:()=>d});var l=r(91130);const t=e=>l.A.get(`/api/v3/spaces/${e}/scim`),n=(e,s)=>e?l.A.get(`/api/v3/spaces/${s}/scim/${e}`):Promise.resolve({data:null}),i=(e,s)=>l.A.post(`/api/v3/spaces/${e}/scim`,s),o=(e,s,r)=>l.A.patch(`/api/v3/spaces/${s}/scim/${e}`,r),a=(e,s)=>l.A.delete(`/api/v3/spaces/${s}/scim/${e}`),d=(e,s)=>e?l.A.post(`/api/v3/spaces/${s}/scim/${e}/rotate-token`):Promise.resolve({data:null})},52248:(e,s,r)=>{r.r(s),r.d(s,{default:()=>le});var l=r(96540),t=r(65258),n=r(99728),i=r(53746),o=r(63956);const a=()=>{(0,i.A)();const{loaded:e,items:s}=(0,o.Xy)(),{available:r,SCIMID:l}=e?(s||[])[0]:{};return{scimItemsLoaded:e,scimAvailable:r,scimId:l}};r(98992),r(54520),r(81454),r(37550);var d=r(34843),c=r(52035),u=r(84929),m=r(91130);var p=r(57377);const g=(0,u.Iz)((e=>{let{spaceId:s,scimId:r}=e;return(0,u.Rq)((0,c.eU)((()=>(e=>{let{spaceId:s,scimId:r}=e;return m.A.get(`/api/v3/spaces/${s}/scim/${r}/membership-rules/options`)})({spaceId:s,scimId:r}))))}),p.Ay),h=(e,s,r)=>{const{state:l,data:t,error:n}=r(e);return r(s)||{loaded:"loading"!==l,rules:t?.data||[],hasError:"hasError"===l,error:n}},I=(0,u.Iz)((()=>(0,c.eU)(0)),p.Ay),b=(0,u.Iz)((e=>{let{spaceId:s,scimId:r}=e;const l=(0,u.Rq)((0,c.eU)((e=>(e(I({spaceId:s,scimId:r})),(e=>{let{spaceId:s,scimId:r}=e;return m.A.get(`/api/v3/spaces/${s}/scim/${r}/membership-rules`)})({spaceId:s,scimId:r}))))),t=(0,u.tx)();return(0,c.eU)((e=>h(l,t,e)),((e,n,i)=>{if(i===u.Ut)return n(t,u.Ut),void n(I({spaceId:s,scimId:r}),(e=>e+1));const o=h(l,t,e);n(t,"function"===typeof i?i(o):i)}))}),p.Ay);var x=r(24609);const v="new-scim-rule",f=e=>{let{scimId:s}=e;const r=(0,x.vt)(),l=(0,d.md)(g({spaceId:r,scimId:s}));return{loaded:"loading"!==l.state,options:l.data?.data||{},hasError:"hasError"===l.state,error:l.error}},j=e=>{let{scimId:s}=e;const r=(0,x.vt)();return(0,d.Xr)(b({spaceId:r,scimId:s}))};var y=r(47090);const C=e=>{let{scimId:s}=e;const{loaded:r,hasError:t,options:n,error:i}=f({scimId:s}),{loaded:o,rules:a,hasError:c,error:u}=(e=>{let{scimId:s}=e;const r=(0,x.vt)();return(0,d.md)(b({spaceId:r,scimId:s}))})({scimId:s}),m=r&&o,p=m&&(t||c),g=m&&!p&&0===a.length,h=p?i||u:null,I=h?(0,y.o)(h.response?.data?.errorMsgKey):null,j=(0,l.useMemo)((()=>(n?.groups||[]).filter((e=>{let{id:s}=e;return!(a||[]).map((e=>{let{scimGroupID:s}=e;return s})).includes(s)}))),[n,a]),C=(0,l.useMemo)((()=>(a||[]).some((e=>{let{role:s}=e;return"admin"===s}))),[a]),A=(0,l.useMemo)((()=>m&&!!j.length&&!a.some((e=>{let{id:s}=e;return s===v}))),[m,a,j]);return{loaded:m,rules:a,unassignedGroups:j,adminExists:C,showEmptyRules:g,canAddNewRule:A,hasError:p,error:I}};var A=r(74848);const E=e=>{let{children:s}=e;return(0,A.jsx)(t.Flex,{"data-testid":"scim-groups-empty-rules",height:"100%",alignItems:"center",justifyContent:"center",children:(0,A.jsx)(t.Flex,{width:{max:"562px"},column:!0,gap:4,alignItems:"center",children:s})})},k=e=>{let{scimId:s,...r}=e;const n=(e=>{let{scimId:s}=e;const r=j({scimId:s}),t={id:v,isEdit:!0};return(0,l.useCallback)((()=>{r((e=>({...e,rules:[...e?.rules||[],t]})))}),[r])})({scimId:s});return(0,A.jsx)(t.Button,{...r,onClick:n})},S=(0,l.memo)((e=>{let{scimId:s}=e;return(0,A.jsxs)(E,{children:[(0,A.jsx)(t.TextBigger,{textAlign:"center",lineHeight:"20px",children:"Here you can create rules to automatically assign users to roles and rooms based on the SCIM group they belong."}),(0,A.jsx)(t.Box,{children:(0,A.jsx)(k,{label:"Create a new rule",scimId:s})})]})}));var w=r(6304),M=r(63872);const D=e=>{let{scimId:s,onSuccess:r}=e;const t=(0,x.vt)(),[n,,i,o]=(0,w.A)(),[a,d]=(0,M.A)(),c=(0,l.useCallback)((e=>{i(),(e=>{let{spaceId:s,scimId:r,payload:l}=e;return m.A.post(`/api/v3/spaces/${s}/scim/${r}/membership-rules`,l)})({spaceId:t,scimId:s,payload:e}).then((e=>{let{data:s}=e;a({header:"Success",text:"Successfully created SCIM membership rule."}),"function"===typeof r&&r(s)})).catch((e=>{d(e)})).finally((()=>{o()}))}),[s,i,o,r,a,d]);return{loading:n,create:c}},R=e=>{let{scimId:s,onSuccess:r}=e;const t=(0,x.vt)(),[n,,i,o]=(0,w.A)(),[a,d]=(0,M.A)(),c=(0,l.useCallback)((e=>{const{id:l,...n}=e;i(),(e=>{let{spaceId:s,scimId:r,ruleId:l,payload:t}=e;return m.A.put(`/api/v3/spaces/${s}/scim/${r}/membership-rules/${l}`,t)})({spaceId:t,scimId:s,ruleId:l,payload:n}).then((e=>{let{data:s}=e;a({header:"Success",text:"Successfully updated SCIM membership rule."}),"function"===typeof r&&r(s)})).catch((e=>{d(e)})).finally((()=>{o()}))}),[s,i,o,r,a,d]);return{loading:n,update:c}},U=e=>{let{scimId:s,onSuccess:r}=e;const t=(0,x.vt)(),[n,,i,o]=(0,w.A)(),[a,d]=(0,M.A)(),c=(0,l.useCallback)((e=>{i(),(e=>{let{spaceId:s,scimId:r,ruleId:l}=e;return m.A.delete(`/api/v3/spaces/${s}/scim/${r}/membership-rules/${l}`)})({spaceId:t,scimId:s,ruleId:e}).then((e=>{a({header:"Success",text:"Successfully deleted SCIM membership rule."}),"function"===typeof r&&r(e)})).catch((e=>{d(e)})).finally((()=>{o()}))}),[s,i,o,r,a,d]);return{loading:n,deleteRule:c}},$=e=>{let{scimId:s,rule:r={}}=e;const[t,n]=(0,l.useState)(r),[i,,o,a]=(0,w.A)(),{id:d,scimGroupID:c,role:u,roomIDs:m,isEdit:g}=t,h=(e=>{let{scimId:s}=e;const r=j({scimId:s});return(0,l.useCallback)((function(e){let s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];r((r=>{const l=(r.rules||[]).map((r=>r.id===e?{...r,isEdit:s}:r));return{...r,rules:l}}))}))})({scimId:s}),I=(e=>{let{scimId:s}=e;const r=j({scimId:s});return(0,l.useCallback)((e=>{r((s=>{const r=(s.rules||[]).filter((s=>s.id!==e));return{...s,rules:r}}))}))})({scimId:s}),b=(e=>{let{scimId:s}=e;const r=j({scimId:s});return(0,l.useCallback)(((e,s)=>{r((r=>{const l=(r.rules||[]).map((r=>r.id===e?s:r));return{...r,rules:l}}))}))})({scimId:s}),x=(0,l.useCallback)((e=>{b(d,e)}),[d,b]),f=(0,l.useCallback)((()=>{I(d),a()}),[I,a]),{loading:y,create:C}=D({scimId:s,onSuccess:x}),{loading:A,update:E}=R({scimId:s,onSuccess:x}),{loading:k,deleteRule:S}=U({scimId:s,onSuccess:f}),M=y||A||k,$=(0,l.useMemo)((()=>!(0,p.Ay)(r,t)),[r,t]),G=(0,l.useMemo)((()=>d===v&&$),[d,$]),T=(0,l.useMemo)((()=>g&&!!c&&!!u&&m?.length||!1),[g,c,u,m?.length]),B=(0,l.useMemo)((()=>g&&$&&r?.id!==v),[r?.id,g,$]),F=(0,l.useCallback)((e=>s=>{const r=Array.isArray(s)?s.map((e=>{let{value:s}=e;return s})):s.value;n((s=>({...s,[e]:r})))}),[n]),N=(0,l.useCallback)((()=>{h(d)}),[d,h]),P=(0,l.useCallback)((()=>{h(r.id,!1),n(r)}),[r,$,h,n]),L=(0,l.useCallback)((()=>{(d===v?C:E)({id:d,scimGroupID:c,role:u,roomIDs:m})}),[d,c,u,m,C]),z=(0,l.useCallback)((()=>{d===v?I(d):S(d)}),[d,S,I]),_=(0,l.useCallback)((()=>{d!==v||$?o():z(d)}),[d,$,o,z]);return(0,l.useEffect)((()=>{n(r)}),[r,n]),{loading:M,scimGroupID:c,roomIDs:m,role:u,isEdit:g,canSave:T,canUndo:B,confirmationOpen:i,isNewUnsaved:G,onGroupChange:F("scimGroupID"),onRoleChange:F("role"),onRoomsChange:F("roomIDs"),onEdit:N,onReset:P,onSave:L,onDelete:_,onConfirmDelete:z,onDeclineDelete:a}};r(72577);var G=r(77148);const T=(0,l.memo)((e=>{let{isEdit:s,label:r,value:n,options:i,isMulti:o,disabled:a,onChange:d,error:c}=e;const u=s?t.Text:t.TextBig,m=(0,l.useMemo)((()=>i.filter((e=>{let{hidden:s}=e;return!s}))),[i]),p=(0,l.useMemo)((()=>o?i.filter((e=>(n||[]).includes(e.value))):i.find((e=>e.value===n))),[n,o]),g=(0,l.useMemo)((()=>Array.isArray(p)?p.map((e=>{let{label:s}=e;return s})).join(", "):p?.label||""),[p]);return c?(0,A.jsxs)(t.Flex,{alignItems:"center",gap:1,children:[(0,A.jsx)(t.Icon,{name:"warning_triangle",size:"small",color:"warning"}),(0,A.jsx)(t.Text,{children:c})]}):(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)(t.Flex,{alignItems:"center",gap:2,children:[(0,A.jsxs)(u,{children:[r,s?"":":"]}),s?(0,A.jsx)(t.Select,{value:p,options:m,isMulti:o,disabled:a,onChange:d}):(0,A.jsx)(u,{strong:!0,children:g})]}),s?null:(0,A.jsx)(G.A,{vertical:!0,height:"20px",color:"border"})]})})),B=e=>{let{scimId:s,isEdit:r,label:t,value:n,onChange:i,unassignedGroups:o,...a}=e;const{loaded:d,options:c,hasError:u}=f({scimId:s}),m=(0,l.useMemo)((()=>o.map((e=>{let{id:s}=e;return s}))),[o]),p=(0,l.useMemo)((()=>(c?.groups||[]).map((e=>{let{id:s,displayName:r}=e;return{label:r,value:s,hidden:!m.includes(s)}}))),[c?.groups,m]),g=u?"Error on fetching groups":null;return d?(0,A.jsx)(T,{isEdit:r,label:t,value:n,options:p,onChange:i,error:g,...a}):null},F=e=>{let{scimId:s,isEdit:r,label:t,value:n,onChange:i}=e;const{loaded:o,options:a,hasError:d}=f({scimId:s}),c=(0,l.useMemo)((()=>(a?.roles||[]).map((e=>({label:e,value:e})))),[a?.roles]),u=d?"Error on fetching roles":null;return o?(0,A.jsx)(T,{isEdit:r,label:t,value:n,options:c,onChange:i,error:u}):null},N=e=>{let{scimId:s,isEdit:r,label:t,value:n,onChange:i}=e;const{loaded:o,options:a,hasError:d}=f({scimId:s}),c=(0,l.useMemo)((()=>(a?.rooms||[]).map((e=>{let{id:s,name:r}=e;return{label:r,value:s}}))),[a?.rooms]),u=d?"Error on fetching rooms":null;return o?(0,A.jsx)(T,{isEdit:r,label:t,value:n,options:c,isMulti:!0,onChange:i,error:u}):null},P=e=>{let{isUnsaved:s,onConfirm:r,onDecline:l}=e;const n=s?"You are going to remove this item that has some unsaved changes.":"You are going to completely remove this rule and this action cannot be reverted.";return(0,A.jsx)(t.ConfirmationDialog,{title:"Delete item?",handleConfirm:r,handleDecline:l,confirmLabel:"Yes, delete",declineLabel:"Close",backdropContainerProps:{zIndex:"120"},message:(0,A.jsxs)(t.Flex,{column:!0,gap:2,children:[(0,A.jsx)(t.TextBig,{children:n}),(0,A.jsx)(t.TextBig,{children:"Are you sure that you want to delete this item?"})]})})};var L=r(74891);const z=(0,r(3203).A)((0,L.A)(t.Button)),_=e=>({group:e?"Users that belong to group":"Group",role:e?"will be assigned the role of":"Role",rooms:e?"and will be added to room(s)":"Rooms"}),X=e=>{let{scimId:s,rule:r,unassignedGroups:l}=e;const{loading:n,scimGroupID:i,roomIDs:o,role:a,isEdit:d,canSave:c,canUndo:u,confirmationOpen:m,isNewUnsaved:p,onGroupChange:g,onRoleChange:h,onRoomsChange:I,onEdit:b,onReset:x,onSave:v,onDelete:f,onConfirmDelete:j,onDeclineDelete:y}=$({scimId:s,rule:r});return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)(t.Flex,{"data-testid":"scim-groups-rule-container",flex:"grow",alignItems:"center",justifyContent:"between",padding:[4],border:{side:"all",color:"border"},children:[(0,A.jsxs)(t.Flex,{alignItems:"center",gap:2,children:[(0,A.jsx)(B,{scimId:s,label:_(d).group,value:i,isEdit:d,disabled:n,onChange:g,unassignedGroups:l}),(0,A.jsx)(F,{scimId:s,label:_(d).role,value:a,isEdit:d,disabled:n,onChange:h}),(0,A.jsx)(N,{scimId:s,label:_(d).rooms,value:o,isEdit:d,disabled:n,onChange:I})]}),(0,A.jsxs)(t.Flex,{alignItems:"center",gap:2,children:[u?(0,A.jsx)(z,{flavour:"borderless",neutral:!0,icon:"refresh",disabled:n,onClick:x,tooltip:"Undo changes",feature:"ScimMembershipRule",payload:{ruleId:r.id,btnAction:"Undo rules changes"}}):null,d?(0,A.jsx)(z,{flavour:"borderless",neutral:!0,icon:"save",disabled:n||!c,onClick:v,tooltip:"Save",feature:"ScimMembershipRule",payload:{ruleId:r.id,btnAction:"Save rule"}}):(0,A.jsx)(z,{flavour:"borderless",neutral:!0,icon:"pencilOutline",disabled:n,onClick:b,tooltip:"Edit",feature:"ScimMembershipRule",payload:{ruleId:r.id,btnAction:"Edit rule"}}),(0,A.jsx)(z,{flavour:"borderless",danger:!0,icon:"trashcan",disabled:n,onClick:f,tooltip:"Delete",feature:"ScimMembershipRule",payload:{ruleId:r.id,btnAction:"Delete rule"}})]})]}),m?(0,A.jsx)(P,{isUnsaved:p,onConfirm:j,onDecline:y}):null]})};var Y=r(60908);const q=e=>{let{adminExists:s}=e;const r=(0,l.useMemo)((()=>s?"All groups have been configured":"No space administrators were assigned"),[s]),n=(0,l.useMemo)((()=>({name:s?"check":"warning_triangle",color:s?"primary":"error"})),[s]);return(0,A.jsxs)(t.Flex,{alignItems:"center",gap:2,children:[(0,A.jsx)(t.Icon,{...n}),(0,A.jsx)(t.TextBig,{children:r})]})},O=e=>{let{scimId:s,rules:r,canAddNewRule:l,unassignedGroups:n,adminExists:i}=e;return(0,A.jsx)(Y.Ay,{feature:"ScimMembershipRules",children:(0,A.jsxs)(t.Flex,{"data-testid":"scim-groups-rules-list",column:!0,gap:4,children:[r.map((e=>(0,A.jsx)(X,{scimId:s,rule:e,unassignedGroups:n},e.id))),n.length?(0,A.jsx)(t.Box,{children:(0,A.jsx)(k,{label:"Add new",scimId:s,disabled:!l})}):(0,A.jsx)(q,{adminExists:i})]})})};var Z=r(29022),H=r(55093);const J=e=>{let{scimId:s}=e;const{loaded:r,rules:l,unassignedGroups:n,adminExists:i,showEmptyRules:o,canAddNewRule:a,hasError:d,error:c}=C({scimId:s});return r?d?(0,A.jsx)(Z.A,{title:"Error",children:(0,A.jsx)(t.TextBig,{children:c})}):o?(0,A.jsx)(S,{scimId:s}):(0,A.jsx)(O,{scimId:s,rules:l,canAddNewRule:a,unassignedGroups:n,adminExists:i}):(0,A.jsx)(H.A,{title:"Loading..."})};var K=r(15920),Q=r(89942),V=r(61841),W=r(88325);const ee=(0,l.memo)((e=>{let{scimAvailable:s}=e;const r=(0,K.Zp)(),[n]=(0,V.Ay)(),{url:i}=(0,W.A)(),o=s?"You do not have any SCIM integration activated. Please activate a SCIM integration first, and then you will be able to configure user groups.":"This feature is only available to paid plans.",a=(0,l.useCallback)((()=>{const e=(0,Q.PP)();(0,Q.Z8)({...e,userManagementActiveTab:1}),r(`/spaces/${n}/settings/users`,{replace:!0})}),[n,Q.PP,Q.Z8,r]),d=(0,l.useCallback)((()=>{r(i,{replace:!0})}),[i,r]),c=(0,l.useMemo)((()=>({label:s?"Activate SCIM integration":"Upgrade now!",onClick:s?a:d,textTransform:""})),[s,a,d]);return(0,A.jsxs)(E,{children:[(0,A.jsx)(t.TextBigger,{textAlign:"center",lineHeight:"20px",children:o}),(0,A.jsx)(t.Box,{children:(0,A.jsx)(t.Button,{...c})})]})})),se=()=>{const{scimItemsLoaded:e,scimAvailable:s,scimId:r}=a();return e?r?(0,A.jsx)(J,{scimId:r}):(0,A.jsx)(ee,{scimAvailable:s}):(0,A.jsx)(H.A,{title:"Loading..."})},re=()=>(0,A.jsx)(Z.A,{title:"No permissions",children:(0,A.jsx)(t.TextBig,{children:"You don't have permissions to view this page"})}),le=e=>{const s=(0,n.JT)("oidc:Manage");return(0,A.jsx)(Y.Ay,{tab:"ScimUserGroups",children:(0,A.jsx)(t.Flex,{"data-testid":"scim-groups-manager",column:!0,gap:4,height:"100%",overflow:{vertical:"auto"},flex:"grow",padding:[4,4,0,4],...e,children:s?(0,A.jsx)(se,{}):(0,A.jsx)(re,{})})})}},53746:(e,s,r)=>{r.d(s,{A:()=>a});var l=r(34646),t=r(24609),n=r(32052),i=r(1457),o=r(63956);const a=()=>{const e=(0,t.vt)(),s=(0,o.cP)(e),r=(0,o.Bc)();(0,n.A)((()=>({enabled:!!e,fetch:()=>(0,l.Zl)(e),onFail:e=>s({...i.ue,error:e?.response?.data||e}),onSettle:()=>s({loading:!1,loaded:!0}),onSuccess:e=>{s({...i.ue,items:e})}})),[r,e])}},63956:(e,s,r)=>{r.d(s,{Bc:()=>u,Hy:()=>I,Xy:()=>h,cP:()=>g,dI:()=>b,nB:()=>m});var l=r(96540),t=r(52035),n=r(34843),i=r(84929),o=r(24609),a=r(1457),d=r(34646),c=r(57377);const u=()=>{const e=(0,o.vt)();return(0,n.md)((0,a.Rq)(e))},m=()=>{const e=(0,o.vt)(),s=(0,n.Xr)((0,a.Rq)(e));return(0,l.useCallback)((()=>s((e=>e+1))),[s])},p=(0,i.Iz)((e=>{let{id:s,key:r}=e;return(0,t.eU)((e=>{const l=e((0,a.oL)(s));return r?l[r]:l}),((e,l,t)=>{l((0,a.oL)(s),(e=>r?{...e,[r]:t}:{...e,...t}))}))}),c.Ay),g=(e,s)=>(0,n.Xr)(p({id:e,key:s})),h=e=>{const s=(0,o.vt)();return(0,n.md)(p({id:s,key:e}))},I=e=>(0,n.fp)((0,a.u)(e)),b=e=>{const s=(0,o.vt)(),[r,t]=I(s);return{integration:r,create:(0,l.useCallback)((function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,d.lG)(s,{integrationID:e,...r})}),[s]),update:(0,l.useCallback)((function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,d.ON)(e,s,r)}),[e,s]),remove:(0,l.useCallback)((()=>(0,d.Uj)(e,s).then((()=>(t(null),Promise.resolve())))),[e,s,t]),rotateToken:(0,l.useCallback)((()=>(0,d.lt)(e,s)),[e,s])}}}}]);